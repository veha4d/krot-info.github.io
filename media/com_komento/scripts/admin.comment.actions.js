Komento.module("admin.comment.actions",function(e){var t=this;Komento.require().library("dialog").script("komento.common","admin.language").done(function(){var n={};Komento.options.jversion=="1.5"?(n.published="images/tick.png",n.unpublished="images/publish_x.png"):(n.published="templates/bluestork/images/admin/tick.png",n.unpublished="templates/bluestork/images/admin/publish_x.png"),Komento.actions={showColumnsConfiguration:function(){e(".columnsConfiguration").toggle()},loadReplies:function(t){var n=e(".kmt-row").length;Komento.ajax("admin.views.comments.loadreplies",{parentId:t,startCount:n},{success:function(n){e("#kmt-"+t).after(n).find(".linked-cell").text("-"),e(".kmt-row").each(function(e,t){var n=e%2;t.removeClass("row1","row0").addClass("row"+n)}),Komento.options.jversion<"3.0"&&e("#toggle").attr("onClick","checkAll("+e(".kmt-row").length+");")}})},submit:function(t,n){e(".foundryDialog").length!=0&&e(".foundryDialog").controller().close(),Komento.actions.affectchild=n;var r=[],i=[];e('input[type="checkbox"]:checked').each(function(n,s){if(s.value!=""){r.push(s.value),i.push(e("#kmt-"+s.value));var o;t=="unstick"||t=="stick"?o="sticked":o="published",e("#kmt-"+s.value).find("."+o+"-cell a img").attr("src",Komento.options.spinner)}}),Komento.ajax("admin.views.comments."+t,{ids:r,affectchild:n},{success:function(){var n=[],r=[];e.each(i,function(e,i){Komento.actions[t](i),i.attr("childs")>0&&n.push(1),i.attr("parentid")!=0&&r.push(1)}),(t=="publish"&&r.length>0||t!="publish"&&n.length>0)&&Komento.actions[t+"Dialog"]()},fail:function(){}})},publish:function(t){var r=t.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");t.find(".published-cell a").attr("onclick",r).attr("title",e.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?t.find(".published-cell a img").attr("src",n.published):t.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),Komento.actions.publishParent(t),Komento.actions.publishChild(t)},publishParent:function(t){if(!t.exists())return;var r=t.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");t.find(".published-cell a").attr("onclick",r).attr("title",e.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?t.find(".published-cell a img").attr("src",n.published):t.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),t.attr("parentid")!=0&&Komento.actions.publishParent(e("#kmt-"+t.attr("parentid")))},publishChild:function(t){if(!t.exists())return;var r=t.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");t.find(".published-cell a").attr("onclick",r).attr("title",e.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?t.find(".published-cell a img").attr("src",n.published):t.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish");if(Komento.actions.affectchild==1&t.attr("childs")>0){var i=t.attr("id").split("-")[1];Komento.actions.publishChild(e('.kmt-row[parentid="'+i+'"]'))}},publishDialog:function(){e.dialog("<p>"+e.language("COM_KOMENTO_PARENT_PUBLISHED")+"</p>")},publishParentDialog:function(){e.dialog("<p>"+e.language("COM_KOMENTO_PARENT_PUBLISHED")+"</p>")},unpublish:function(t){if(!t.exists())return;var r=t.find(".published-cell a").attr("onclick").replace("unpublish","publish");t.find(".published-cell a").attr("onclick",r).attr("title",e.language("COM_KOMENTO_PUBLISH_ITEM")),Komento.options.jversion<"3.0"?t.find(".published-cell a img").attr("src",n.unpublished):t.find(".published-cell i").removeClass("icon-publish").addClass("icon-unpublish");if(t.attr("childs")>0){var i=t.attr("id").split("-")[1];Komento.actions.unpublish(e('.kmt-row[parentid="'+i+'"]'))}},unpublishDialog:function(){e.dialog("<p>"+e.language("COM_KOMENTO_CHILD_UNPUBLISHED")+"</p>")},stick:function(e){var t=e.find(".sticked-cell a").attr("onclick").replace("stick","unstick");e.find(".sticked-cell a").attr("onclick",t),Komento.options.jversion<"3.0"?e.find(".sticked-cell a img").attr("src","/administrator/components/com_komento/assets/images/sticked.png"):e.find(".sticked-cell i").removeClass("icon-star-empty").addClass("icon-star")},stickDialog:function(){},unstick:function(e){var t=e.find(".sticked-cell a").attr("onclick").replace("unstick","stick");e.find(".sticked-cell a").attr("onclick",t),Komento.options.jversion<"3.0"?e.find(".sticked-cell a img").attr("src","/administrator/components/com_komento/assets/images/unsticked.png"):e.find(".sticked-cell i").removeClass("icon-star").addClass("icon-star-empty")},unstickDialog:function(){}},Komento.prepare={checkChild:function(){var t=[];return e('input[type="checkbox"]:checked').each(function(n,r){r.value!=""&&e("#kmt-"+r.value).attr("childs")>0&&t.push(1)}),t.length>0?!0:!1},remove:function(){var t,n;Komento.prepare.checkChild()?(t=e.language("COM_KOMENTO_CONFIRM_DELETE_AFFECT_ALL_CHILD"),n='<button onclick="Komento.prepare.removeall()">'+e.language("COM_KOMENTO_DELETE_ALL_CHILD")+"</button>",n+='<button onclick="Komento.prepare.removesingle()">'+e.language("COM_KOMENTO_DELETE_MOVE_CHILD_UP")+"</button>"):(t=e.language("COM_KOMENTO_CONFIRM_DELETE"),n='<button onclick="Komento.prepare.removeall()">'+e.language("COM_KOMENTO_DELETE_COMMENT")+"</button>");var r='<div style="text-align: center;"><p>'+t+"</p>"+n+"</div>";e.dialog(r)},removeall:function(){prepareSubmit("remove",1)},removesingle:function(){prepareSubmit("remove",0)},publish:function(){if(Komento.prepare.checkChild()){var t=e.language("COM_KOMENTO_CONFIRM_PUBLISH_AFFECT_ALL_CHILD"),n='<button onclick="Komento.prepare.publishall()">'+e.language("COM_KOMENTO_PUBLISH_ALL_CHILD")+"</button>";n+='<button onclick="Komento.prepare.publishsingle()">'+e.language("COM_KOMENTO_PUBLISH_SINGLE")+"</button>";var r='<div style="text-align: center;"><p>'+t+"</p>"+n+"</div>";e.dialog(r)}else Komento.actions.submit("publish",1)},publishall:function(){Komento.actions.submit("publish",1)},publishsingle:function(){Komento.actions.submit("publish",0)},unpublish:function(){Komento.actions.submit("unpublish",1)},stick:function(){Komento.actions.submit("stick",1)},unstick:function(){Komento.actions.submit("unstick",1)},saveColumns:function(){submitform("saveColumns")}},window.submitbutton=function(e){Komento.prepare[e]()},window.prepareSubmit=function(t,n){e(".foundryDialog").length!=0&&e(".foundryDialog").controller().close(),document.adminForm.affectchild.value=n,submitform(t)},window.listItemTask=function(e,t){var n=document.adminForm,r=n[e];if(r){for(var i=0;!0;i++){var s=n["cb"+i];if(!s)break;s.checked=!1}r.checked=!0,n.boxchecked.value=1,submitbutton(t)}return!1},t.resolve()})});